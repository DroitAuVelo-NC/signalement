<html>
  <body>
    <title>Signaler</title>
    
  </body>
<form id="myForm">
    <input type="file" id="fileInput" required>
    <input type="text" id="name" placeholder="Nom" required>
    <input type="email" id="email" placeholder="Email" required>
    <input type="text" id="latitude" placeholder="Latitude" required>
    <input type="text" id="longitude" placeholder="Longitude" required>
    <button type="submit">Envoyer</button>
</form>

<script>
document.getElementById("myForm").addEventListener("submit", async function(event) {
    event.preventDefault();
    
    let fileInput = document.getElementById("fileInput").files[0];
    let reader = new FileReader();
    reader.readAsDataURL(fileInput);
    
    reader.onload = async function() {
        let base64File = reader.result.split(',')[1];
        
        let data = {
            file: base64File,
            fileType: fileInput.type,
            fileName: fileInput.name,
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            latitude: document.getElementById("latitude").value,
            longitude: document.getElementById("longitude").value
        };
        
        // Envoi des donn√©es √† Google Apps Script
        let response = await fetch("https://white-truth-2869.ivan-zupancic.workers.dev", {
            method: "POST",
            body: JSON.stringify(data),
            headers: { "Content-Type": "application/json" }
        });
        
        let result = await response.json();
      
            // Envoi notification Slack
            fetch("https://hooks.slack.com/services/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", {
                method: "POST",
                body: JSON.stringify({
                    text: `üÜï Nouvelle soumission :\nüìå Nom: ${data.name}\nüìß Email: ${data.email}\nüåç Localisation: (${data.latitude}, ${data.longitude})\nüìé [Fichier](${result.fileUrl})`
                }),
                headers: { "Content-Type": "application/json" }
            });

       
    };
});
</script>
</html>
